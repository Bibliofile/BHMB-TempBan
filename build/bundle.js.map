{"version":3,"file":"bundle.js","sources":["../src/index.ts"],"sourcesContent":["import { MessageBot, Player } from '@bhmb/bot'\r\nimport { UIExtensionExports } from '@bhmb/ui'\r\n\r\ninterface Config {\r\n  time: number\r\n  bans: {[name: string]: number}\r\n}\r\n\r\nimport html from './tab.html'\r\n\r\nMessageBot.registerExtension('bibliofile/tempban', (ex, world) => {\r\n  const defaultConfig: Config = { time: 10, bans: {} }\r\n  const getConfig = () => ex.storage.get('config', defaultConfig)\r\n\r\n  function ban(name: string, time = getConfig().time) {\r\n    name = name.toLocaleUpperCase()\r\n\r\n    ex.bot.send('/ban ' + name)\r\n\r\n    ex.storage.with('config', defaultConfig, config => {\r\n      config.bans[name] = Date.now() + 60000 * time\r\n    })\r\n  }\r\n\r\n  function banListener({ player, message}: { player: Player, message: string}) {\r\n    if (!player.isStaff) return\r\n    message = message.toLocaleLowerCase()\r\n    if (!message.startsWith('/temp-ban')) return\r\n\r\n    let { time } = getConfig()\r\n    const match = message.match(/^\\/temp-ban-(\\d+) (.*)$/)\r\n    if (match) {\r\n      time = +match[1]\r\n      message = match[2]\r\n    }\r\n\r\n    const target = world.getPlayer(message)\r\n    if (target.isStaff) return\r\n\r\n    ban(target.name, time)\r\n  }\r\n  world.onMessage.sub(banListener);\r\n\r\n  world.addCommand('clear-temp-blacklist', player => {\r\n    if (!player.isAdmin) return\r\n    ex.storage.with('config', defaultConfig, config => {\r\n      Object.keys(config.bans).forEach(name => {\r\n        ex.bot.send('/unban {{NAME}}', { name })\r\n      })\r\n      config.bans = {}\r\n    })\r\n  })\r\n\r\n  let timeout: number\r\n  function unbanChecker() {\r\n    var now = Date.now();\r\n    var config = getConfig();\r\n\r\n    Object.keys(config.bans).forEach(name => {\r\n      if (config.bans[name] < now) {\r\n        ex.bot.send('/unban {{NAME}}', { name })\r\n        delete config.bans[name]\r\n      }\r\n    });\r\n    timeout = setTimeout(unbanChecker, 30000);\r\n  }\r\n  unbanChecker();\r\n\r\n  ex.remove = () => {\r\n    clearTimeout(timeout)\r\n    world.onMessage.unsub(banListener)\r\n    world.removeCommand('clear-temp-blacklist')\r\n  }\r\n\r\n  // Browser only\r\n  const ui = ex.bot.getExports('ui') as UIExtensionExports | undefined\r\n  if (!ui) return\r\n\r\n  const tab = ui.addTab('Temporary Bans');\r\n  tab.innerHTML = html\r\n\r\n  tab.addEventListener('input', function () {\r\n    ex.storage.with('config', defaultConfig, config => {\r\n      config.time = +tab.querySelector('input')!.value\r\n    })\r\n  })\r\n\r\n  ex.remove = (orig => () => {\r\n    orig()\r\n    ui.removeTab(tab)\r\n  })(ex.remove)\r\n});\r\n"],"names":["MessageBot"],"mappings":"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"}