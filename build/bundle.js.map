{"version":3,"file":"bundle.js","sources":["../src/index.ts"],"sourcesContent":["import { MessageBot, Player } from '@bhmb/bot'\nimport { UIExtensionExports } from '@bhmb/ui'\n\ninterface Config {\n  time: number\n  bans: {[name: string]: number}\n}\n\nimport html from './tab.html'\n\nMessageBot.registerExtension('bibliofile/tempban', (ex, world) => {\n  const defaultConfig: Config = { time: 10, bans: {} }\n  const getConfig = () => ex.storage.get('config', defaultConfig)\n\n  function ban(name: string, time = getConfig().time) {\n    name = name.toLocaleUpperCase()\n\n    ex.bot.send('/ban ' + name)\n\n    ex.storage.with('config', defaultConfig, config => {\n      config.bans[name] = Date.now() + 60000 * time\n    })\n  }\n\n  function banListener({ player, message }: { player: Player, message: string}) {\n    if (!player.isStaff) return\n    message = message.toLocaleLowerCase()\n    if (!message.startsWith('/temp-ban')) return\n    message = message.substr('/temp-ban'.length)\n\n    let { time } = getConfig()\n    if (/^-\\d+ /.test(message)) { // Custom time `/temp-ban-1 bib`\n      const match = message.match(/^-(\\d+) (.*)$/)!\n      time = +match[1]\n      message = match[2]\n    } else if (message.startsWith(' ')) { // Default time `/temp-ban bib`\n      message = message.substr(1)\n    } else { // Invalid\n      return\n    }\n\n    const target = world.getPlayer(message)\n    if (target.isStaff) return\n\n    ban(target.name, time)\n  }\n  world.onMessage.sub(banListener)\n\n  world.addCommand('clear-temp-blacklist', player => {\n    if (!player.isAdmin) return\n    ex.storage.with('config', defaultConfig, config => {\n      Object.keys(config.bans).forEach(name => {\n        ex.bot.send('/unban {{NAME}}', { name })\n      })\n      config.bans = {}\n    })\n  })\n\n  let timeout: number\n  function unbanChecker() {\n    const now = Date.now()\n    ex.storage.with('config', defaultConfig, config => {\n      Object.keys(config.bans).forEach(name => {\n        if (config.bans[name] < now) {\n          ex.bot.send('/unban {{NAME}}', { name })\n          delete config.bans[name]\n        }\n      })\n    })\n\n    timeout = setTimeout(unbanChecker, 30000)\n  }\n  unbanChecker()\n\n  ex.remove = () => {\n    clearTimeout(timeout)\n    world.onMessage.unsub(banListener)\n    world.removeCommand('clear-temp-blacklist')\n  }\n\n  // Browser only\n  const ui = ex.bot.getExports('ui') as UIExtensionExports | undefined\n  if (!ui) return\n\n  const tab = ui.addTab('Temporary Bans')\n  tab.innerHTML = html\n\n  tab.addEventListener('input', function () {\n    ex.storage.with('config', defaultConfig, config => {\n      config.time = +tab.querySelector('input')!.value\n    })\n  })\n\n  ex.remove = (orig => () => {\n    orig()\n    ui.removeTab(tab)\n  })(ex.remove)\n})\n"],"names":["MessageBot"],"mappings":"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"}